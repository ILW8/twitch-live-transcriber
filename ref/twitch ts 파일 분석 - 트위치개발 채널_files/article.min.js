"use strict";function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,e){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=a){var n,o,r=[],i=!0,c=!1;try{for(a=a.call(t);!(i=(n=a.next()).done)&&(r.push(n.value),!e||r.length!==e);i=!0);}catch(t){c=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(c)throw o}}return r}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _createForOfIteratorHelper(t,e){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){a&&(t=a);var n=0,e=function(){};return{s:e,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,i=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return r=t.done,t},e:function(t){i=!0,o=t},f:function(){try{r||null==a.return||a.return()}finally{if(i)throw o}}}}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(a="Object"===a&&t.constructor?t.constructor.name:a)||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function applyCommentMoreButton(){$(".article-comment .comment-item .content .message").each(function(t,e){var a=$(e),e=8*parseFloat(getComputedStyle(e).fontSize);a.height()>e&&a.addClass("has-more")})}function articleLoad(r){function o(t,a,e){t.replaceWith(a);var n=Array.from(t.find(".comment-item").map(function(t,e){return $(e).attr("id")}));a.find(".comment-item").map(function(t,e){return $(e).attr("id")}).each(function(t,e){-1===n.indexOf(e)&&a.find("#"+e).addClass("fadein")}),e&&$(".article-info.article-info-section").replaceWith(e)}function i(){applyMute(window.LiveConfig),opengraphHandler(),oopeHandler(),applyLocalTimeFix(),applyCommentMoreButton()}$(".reply-form.write").one("click",function(){window.loadRecaptchaPromise()}),$(".reply-form.write textarea.reply-form-textarea").on("input focus",function(){var t=$(this).next().outerHeight();this.style.height="auto",this.style.height=this.scrollHeight+t+"px"});var c=!1;function n(){return Math.max.apply(Math,_toConsumableArray(Array.from($(".article-comment").find("[tabindex]")).map(function(t){return t.tabIndex})))+1}function s(){var t=$("#commentForm");return{gravatar:t.find(".reply-form__user-info__avatar > img"),placeholder:t.find("textarea[name=content]").prop("placeholder"),isVoiceAllowed:t.find(".reply-form-voice-button btn-voicecmt").length}}function l(t){var e=$("#comment .pagination-wrapper"),t=t.find("#comment .pagination-wrapper");0==e.length&&0!=t.length?t.insertAfter($("#comment .list-area")):0!=e.length&&0==t.length?e.remove():e.replaceWith(t);try{var a,n=new URL(t.find(".pagination > li.page-item.active:first > a").attr("href"),location.origin),o=new URL(location.href);n.searchParams.get("cp")!==o.searchParams.get("cp")&&((a=new URL(location.href)).searchParams.set("cp",2),window.history.replaceState({},null,a.href))}catch(t){}}function t(e){var n={recorder:null,stream:null,current:0,min:3,limit:29,dom:$(".voice-comment"),blob:null};function a(e){n.recorder?n.recorder.stopRecording(function(){var t;e?o():n.current<n.min?(ArcaModal.error(i18n("ARTICLE_REQUIRE_MINIMUM_SECONDS",n.min)),o()):(n.dom.find(".progress-wrapper").hide(),n.dom.find(".audio-player").show(),n.dom.find(".btn-cancel").show(),n.dom.find(".btn-record, .btn-stop").hide(),c.find("#voiceCommentUploadButton").show(),t=n.recorder.getBlob(),n.dom.find(".audio-player > audio").attr("src",window.URL.createObjectURL(t)),n.blob=t,$("#voice-comment-upload").show()),n.stream.getTracks().forEach(function(t){return t.stop()}),n.recorder=null,r()}):o()}function o(){n.dom.find(".progress-wrapper").show(),n.dom.find(".audio-player").hide(),n.dom.find(".btn-cancel, .btn-stop").hide(),n.dom.find(".btn-record").show(),$("#voiceCommentUploadButton").hide()}function r(){n.recorder=null,n.stream=null,n.current=0,n.dom.find(".text-current-time").text(0),n.dom.find(".progress-bar").css("width","0%"),$("#voice-comment-upload").hide()}o(),$(".body").on("click",".btn-voicecmt",function(t){var e;t.originalEvent&&((e=$(this).closest("form")).find(".namlacon").hide(),(t=e.find(".voice-comment")).toggle(),t.is(":hidden")?(e.find(".reply-form-textarea-wrapper").show(),e.find("#voiceCommentUploadButton").hide(),e.find("#commentFormButton").show(),e.find("textarea[name=content]:first").prop("required",!0)):(e.find(".reply-form-textarea-wrapper").hide(),e.find("#commentFormButton").hide(),e.find("textarea[name=content]:first").prop("required",!1),"undefined"==typeof RecordRTC&&$.getScript("/node_modules/recordrtc/RecordRTC.js"+window.LiveConfig.CACHE_KEY)))}),n.dom.find(".btn-record").on("click",function(){!function(){if("undefined"==typeof RecordRTC)return ArcaModal.error("".concat(i18n("ARTICLE_LOADING")," ").concat(i18n("ARTICLE_RETRY_LATER")));navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0}).then(function(t){n.dom.find(".btn-stop").show(),n.dom.find(".btn-record").hide(),n.stream=t,n.current=0,n.blob=null,n.dom.find(".text-current-time").text(0),n.dom.find(".record-progress-bar").css("width","0%"),n.recorder=RecordRTC(t,{type:"audio",mimeType:"audio/wav",recorderType:RecordRTC.StereoAudioRecorder,disableLogs:!0,timeSlice:1e3,ondataavailable:function(t){n.current+=1,n.dom.find(".text-current-time").text(n.current);var e=parseFloat(n.current)/parseFloat(n.limit)*100;n.dom.find(".progress-bar").css("width","".concat(e,"%")),n.current>n.limit&&a()}}),n.recorder.startRecording()}).catch(function(t){ArcaModal.error(i18n("ARTICLE_CANT_START_RECORDING"))}):ArcaModal.error(i18n("ARTICLE_NO_SUPPORT_BROWSER"))}()}),n.dom.find(".btn-stop").on("click",function(){a()}),n.dom.find(".btn-cancel").on("click",function(){a(!0),n.blob=null});var i,c=$(n.dom).closest("form");c.on("commentSubmitted",function(){r(),o(),c.find(".voice-comment .upload-alert-view").hide(),c.find(".voice-comment .player-view").show(),c.find("#voiceCommentUploadButton").text(i18n("UPLOAD"))}),c.find("button#voiceCommentUploadButton").on("click",function(){if(!n.blob)return ArcaModal.error(i18n("ARTICLE_RECORDING_FIRST"));c.find("textarea[name=content]:first").val(" ");var t=c.find("input[type=hidden][name=progress]");if(0<t.length)return i.abort(),t.remove(),c.find(".upload-progress-bar").css("width","0%"),c.find(".upload-alert-view").hide(),c.find(".player-view").show(),$(this).text(i18n("UPLOAD")),void c.find("#voice-comment-progress-text").text(i18n("UPLOADING"));c.append($("<input />").attr("type","hidden").attr("name","progress").attr("value","uploading")),$(this).addClass("uploading"),$(this).text(i18n("CANCEL"));t=new FormData;t.append("upload",n.blob,"voicecomment.wav"),t.append("token",e),t.append("purpose","voicecomment"),c.find(".upload-progress-bar").css("width","0%"),c.find(".upload-alert-view").show(),c.find(".player-view").hide();var a=$(this);i=$.ajax({url:"/b/upload",type:"POST",data:t,processData:!1,contentType:!1,dataType:"json",xhr:function(){var t;return(t=$.ajaxSettings.xhr()).upload.onprogress=function(t){t=100*t.loaded/t.total;c.find(".upload-progress-bar").css("width","".concat(t,"%"))},t}}).done(function(t){var e;t.uploaded?(e=t.idx,c.find("input[name=contentType]").val("voicecomment"),c.find("input[type=hidden][name=attachmentId]").remove(),c.append('<input type="hidden" name="attachmentId" value="'+e+'">'),a.text(i18n("ENCODING")),c.find("#voice-comment-progress-text").text("".concat(i18n("ENCODING"),"...")),setTimeout(function(){var t=c.find("input[type=hidden][name=progress]");0<t.length&&"submit"!=t[0].value&&(t[0].value="submit",c.submit())},5e3)):ArcaModal.error(t.message)}).fail(function(t){if("abort"!==t.statusText)try{alert(t.responseJSON.message)}catch(t){alert("error")}c.find(".upload-alert-view").hide(),c.find(".player-view").show()})})}function d(o){$.ajax({method:"GET",dataType:"json",url:"/api/emoticon/"+o,success:function(t){$(".namlacon > .emoticons").empty();var e,a=_createForOfIteratorHelper(t);try{for(a.s();!(e=a.n()).done;){var n=e.value;$(".namlacon > .emoticons").append('<img data-emoticonId="'+o+'" data-attachmentId="'+n.id+'" src="'+n.imageUrl+'" />')}}catch(t){a.e(t)}finally{a.f()}},error:function(t){alert(t)},failure:function(t){alert(t)}})}if($("#commentForm").on("submit",captchaHandlerFactory(function(t,e,a){if(c)return a.fail(),ArcaModal.error(i18n("ARTICLE_ALREADY_PROCESSING")),!1;var n=$(t.target).closest("form");if(e){t=n.find("input[name=g-recaptcha-response]");if(t.length){if(e===t.val())return t.remove(),a.fail(),ArcaModal.error(i18n("ARTICLE_RETRY_LATER")),!1;t.val(e)}else n.append($("<input>").attr({type:"hidden",name:"g-recaptcha-response",value:e}))}if("text"===n.find("input[name=contentType]").val()){if(!nicknameValidityCheck(n.find("input[name=nickname]").val()))return ArcaModal.error(i18n("UPDATE_ACCOUNT_INVALID_ACCOUNT")),a.fail(),!1;if(n.find("textarea").val().length<1)return ArcaModal.error(i18n("ARCACON_INPUT_PLACEHOLDER")),a.fail(),!1}return c=!0,$("#comment").data("progressing",!0),0<$(".article-body > .arca-overlay-notice").length?(n.off("submit"),n.submit()):$.ajax({type:"POST",url:n.attr("action"),data:n.serialize(),success:function(t){a.success();var e=$(t);o($("#comment .list-area"),e.find("#comment .list-area"),e.find(".article-info.article-info-section")),i(),(t=n).find("textarea").val(""),t.find("input[type=hidden]").remove(),t.append($("<input>").attr({type:"hidden",name:"_csrf",value:r._csrf}),$("<input>").attr({type:"hidden",name:"contentType",value:"text"})),t.find(".namlacon").hide(),t.find(".voice-comment").hide(),t.find(".reply-form-textarea-wrapper, .reply-form__submit-button").show(),t.trigger("commentSubmitted"),l(e),requestPermission()},error:function(t){var e;a.fail(),!1===(null===(e=t.responseJSON)||void 0===e?void 0:e.result)?(t=t.responseJSON.message||"",ArcaModal.error(t)):(n.off("submit"),n.submit())},complete:function(){setTimeout(function(){$("#comment").removeData("progressing")},1500),c=!1}}),!1},"comment",'button[type="submit"]')),$(".body").on("click",".article-comment .fetch-comment",function(t){t.preventDefault(),$.ajax({type:"GET",url:location.pathname,success:function(t){t=$(t);o($("#comment .list-area"),t.find("#comment .list-area"),t.find(".article-info.article-info-section")),i(),l(t)},error:function(){"#comment"===location.hash?location.reload():location.href=location.pathname+"#comment"}})}),$(".body").on("click",".article-view .article-comment .comment-item .reply-link",function(){var t=$(this).attr("data-target");if($("#replyForm"+t).length)return $("#replyForm"+t).remove(),!1;var e=s(),a=n(),o=!1,a=$("<form>").addClass("reply-form").attr({id:"replyForm".concat(t),action:"/b/".concat(r.slug,"/").concat(r.articleId,"/comment"),method:"post"}).append($("<input>").attr({type:"hidden",name:"_csrf",value:r._csrf}),$("<input>").attr({type:"hidden",name:"contentType",value:"text"}),$("<input>").attr({type:"hidden",name:"parentId",value:t}),$("<div>").addClass("reply-form__container"+(r.user?"":" recaptcha")).append($("<div>").addClass("reply-form__info").append($("<div>").addClass("reply-form__user-info").append($("<span>").addClass("replay-form-title").text(i18n("ARTICLE_WRITE_REPLY")),$("<div>").addClass("reply-form__user-info__avatar").append(e.gravatar.clone()),r.user?$("<input>").addClass("reply-form-user-input").attr({type:"text",disabled:"true",value:LiveConfig.nickname}):$("<input>").addClass("reply-form-user-input").attr({type:"text",name:"nickname",placeholder:i18n("NAME"),value:r.nickname,required:"required",tabindex:a}).add($("<input>").addClass("reply-form-user-input").attr({type:"password",name:"password",placeholder:i18n("PASSWORD"),value:r.password,required:"required",tabindexstart:a+1}))),$("<div>").addClass("reply-form-button-container").append($("<button>").addClass("reply-form-arcacon-button btn-namlacon").attr({type:"button",tabindex:a+4}).append($("<span>").addClass("ion-android-happy"),$("<span>").addClass("text").text(i18n("ARCACON"))))),$("<div>").addClass("namlacon").hide().append($("<div>").addClass("thumbnails"),$("<div>").addClass("emoticons")),$("<div>").addClass("reply-form-textarea-wrapper").append($("<textarea>").addClass("reply-form-textarea").attr({name:"content",maxlength:"8000",required:"required",tabindex:a+2,placeholder:e.placeholder}).on("input focus",function(){var t=$(this).next().outerHeight();this.style.height="auto",this.style.height=this.scrollHeight+t+"px"}),$("<div>").addClass("reply-form__submit-button-wrapper").append($("<button>").addClass("reply-form__submit-button").attr({type:"submit",id:"replyFormButton".concat(t),tabindex:a+3}).text(i18n("WRITE"))))),r.recaptcha?$("<div>").addClass("recaptcha-privacy recaptcha-privacy-align-right").append("This site is protected by reCAPTCHA and the Google ",$("<a>").attr({href:"https://policies.google.com/privacy"}).text("Privacy Policy")," and ",$("<a>").attr({href:"https://policies.google.com/terms"}).text("Terms of Service")," apply."):"").on("submit",captchaHandlerFactory(function(t,e,a){if(o)return ArcaModal.error(i18n("ARTICLE_ALREADY_PROCESSING")),a.fail(),!1;var n=$(t.target).closest("form");if(LiveConfig.needCaptcha&&e){t=n.find("input[name=g-recaptcha-response]");if(t.length){if(e===t.val())return a.fail(),t.remove(),ArcaModal.error(i18n("ARTICLE_RETRY_LATER")),!1;t.val(e)}else n.append($("<input>").attr({type:"hidden",name:"g-recaptcha-response",value:e}))}o=!0,$("#comment").data("progressing",!0),0<$(".article-body > .arca-overlay-notice").length?(n.off("submit"),n.submit()):$.ajax({type:"POST",url:n.attr("action"),data:n.serialize(),success:function(t){a.success();t=$(t).find("#comment .list-area");$("#comment .list-area").replaceWith(t),i()},error:function(t){!1===t.responseJSON.result?(t=t.responseJSON.message||"",a.fail(),ArcaModal.error(t)):(a.fail(),n.off("submit"),n.submit())},complete:function(){setTimeout(function(){$("#comment").removeData("progressing")},1500),o=!1}})},"comment",'button[type="submit"'));return $("#c_"+t).after(a),a[0].scrollIntoView({block:"center"}),a.find(".reply-form-textarea").focus(),a.find(".namlacon .thumbnails").each(function(t,e){dragToMove(e)}),!1}),$(".body").on("click",".article-view .article-comment .comment-item .edit-link",function(){var t=$(this).attr("data-target");if($("#editForm"+t).length)return $("#editForm"+t).remove(),!1;var e=s(),a=n(),a=$("<form>").addClass("reply-form edit").attr({id:"editForm".concat(t),action:"/b/".concat(r.slug,"/").concat(r.articleId,"/").concat(t,"/edit"),method:"post"}).append($("<input>").attr({type:"hidden",name:"_csrf",value:r._csrf}),$("<input>").attr({type:"hidden",name:"contentType",value:"text"}),$("<div>").addClass("reply-form__container"+(r.user?"":" recaptcha")).append($("<div>").addClass("reply-form__info").append($("<div>").addClass("reply-form__user-info").append($("<span>").addClass("replay-form-title").text(i18n("ARTICLE_REPLY_EDIT")),$("<div>").addClass("reply-form__user-info__avatar").append(e.gravatar.clone()),r.user?$("<input>").addClass("reply-form-user-input").attr({type:"text",disabled:"true",value:LiveConfig.nickname}):$("<input>").addClass("reply-form-user-input").attr({type:"text",name:"nickname",placeholder:i18n("NAME"),value:r.nickname,required:"required",tabindex:a}).add($("<input>").addClass("reply-form-user-input").attr({type:"password",name:"password",placeholder:i18n("PASSWORD"),value:r.password,required:"required",tabindex:a+1})))),$("<div>").addClass("reply-form-textarea-wrapper").append($("<textarea>").addClass("reply-form-textarea").attr({name:"content",maxlength:"8000",required:"required",tabindex:a+2,placeholder:e.placeholder}).val(((e=$("#c_".concat(t," .text.d-none,#c_").concat(t," .message .text,#c_").concat(t," .message .emojicon")).first().clone()).find("img").each(function(){var t=$(this).attr("alt");$(this).replaceWith(t)}),e.text())).on("input",function(){var t=$(this).next().outerHeight();this.style.height="auto",this.style.height=this.scrollHeight+t+"px"}),$("<div>").addClass("reply-form__submit-button-wrapper").append($("<button>").addClass("reply-form__submit-button").attr({type:"submit",id:"replyFormButton".concat(t),tabindex:a+3}).text(i18n("WRITE"))))),r.recaptcha?$("<div>").addClass("recaptcha-privacy recaptcha-privacy-align-right").append("This site is protected by reCAPTCHA and the Google ",$("<a>").attr({href:"https://policies.google.com/privacy"}).text("Privacy Policy")," and ",$("<a>").attr({href:"https://policies.google.com/terms"}).text("Terms of Service")," apply."):"").on("submit",captchaHandlerFactory(function(t,e,a){var n=$(t.target).closest("form");if(e){t=n.find("input[name=g-recaptcha-response]");if(t.length){if(e===t.val())return t.remove(),a.fail(),ArcaModal.error(i18n("ARTICLE_RETRY_LATER")),!1;t.val(e)}else n.append($("<input>").attr({type:"hidden",name:"g-recaptcha-response",value:e}))}0<$(".article-body > .arca-overlay-notice").length?(n.off("submit"),n.submit()):$.ajax({type:"POST",url:n.attr("action"),data:n.serialize(),success:function(t){a.success();t=$(t).find("#comment .list-area");$("#comment .list-area").replaceWith(t),i()},error:function(t){!1===t.responseJSON.result?(t=t.responseJSON.message||"",a.fail(),ArcaModal.error(t)):(a.fail(),n.off("submit"),n.submit())}})},"comment",'button[type="submit"]'));return $("#c_"+t).append(a),a.find("textarea.reply-form-textarea").trigger("input"),a[0].scrollIntoView({block:"center"}),a.find(".reply-form-textarea").focus(),!1}),$(".body").on("click",".article-comment .message .btn-more",function(){$(this).hide(),$(this).parent().removeClass("has-more")}),$(".body").on("click",".comment-wrapper .message",function(){$(this).find(".blur").length&&$(this).find(".blur").removeClass("blur")}),$(".body").on("click",".btn-move-article",function(t){t.preventDefault();var e=prompt(i18n("ARTICLE_MOVE_TARGET_SLUG"),Cookies.get("savedMoveSlug"));e&&$.ajax({method:"POST",dataType:"json",url:"/b/"+r.slug+"/"+r.articleId+"/move",data:{toSlug:e,_csrf:r._csrf},success:function(t){Cookies.set("savedMoveSlug",e,{expires:365}),alert(t.message),location.href="/".concat(e,"/").concat(r.articleId)},error:function(t){t=t.responseJSON;alert(t.message)},failure:function(t){alert(t)}})}),$(".body").on("click",".btn-copy-article",function(){var e=prompt(i18n("ARTICLE_COPY_TARGET_SLUG"),Cookies.get("savedMoveSlug"));e&&$.ajax({method:"POST",dataType:"json",url:"/b/"+r.slug+"/"+r.articleId+"/copy",data:{toSlug:e,_csrf:r._csrf},success:function(t){Cookies.set("savedMoveSlug",e,{expires:365}),location.href="/".concat(r.articleId)},error:function(t){t=t.responseJSON;alert(t.message)},failure:function(t){alert(t)}})}),r.vctoken?t(r.vctoken):$(".btn-voicecmt, .voice-comment").remove(),$(".body").on("click",".btn-namlacon",function(t){var n;t.originalEvent&&(t=(n=$(this).closest("form")).find(".namlacon"),n.find(".reply-form-textarea-wrapper").show(),n.find("textarea[name=content]:first").prop("required",!0),n.find(".reply-form__submit-button").show(),t.toggle(),n.find(".voice-comment").hide(),t.is(":hidden")?n.find(".input-wrapper > .input-block").show():(n.find(".input-wrapper >.input-block").hide(),n.find(".namlacon > .thumbnails").is(":empty")&&$.ajax({method:"GET",dataType:"json",url:"/api/emoticon",success:function(t){for(var e=0;e<t.length;e++){var a=t[e];$(".namlacon > .thumbnails").append('<img data-id="'+a.id+'" src="'+a.thumbnail+'">')}n.find(".namlacon .thumbnails").each(function(t,e){dragToMove(e)}),0<t.length&&d(t[0].id)},error:function(t){alert(t)},failure:function(t){alert(t)}})))}),$(".body").on("click",".namlacon > .thumbnails > img",function(){d($(this).attr("data-id"))}),$(".body").on("click",".namlacon > .emoticons > img",function(){var t=$(this).closest("form");t.find("[name=contentType]").val("emoticon");var e=t.find('input[name="emoticonId"]');e.length?e.val($(this).attr("data-emoticonId")):t.append($("<input>").attr({type:"hidden",name:"emoticonId",value:$(this).attr("data-emoticonId")}));e=t.find('input[name="attachmentId"]');return e.length?e.val($(this).attr("data-attachmentId")):t.append($("<input>").attr({type:"hidden",name:"attachmentId",value:$(this).attr("data-attachmentId")})),t.submit(),!1}),$(".body").on("click",".emoticon",function(){var t=$(this),e=t.attr("data-id");if(e){if(t.data("playblock")){t='<div class="tooltip emoticon-tooltip" role="tooltip"><div class="arrow"></div>';return t+='<div class="emoticon-inner">',t+='<button class="btn btn-primary btn-sm" onclick="location.href=\'/api/emoticon/shop/'.concat(e,"';\">").concat(i18n("ARTICLE_GO_ARCACON"),"</button>"),t+='&nbsp;<button class="btn btn-danger btn-sm" onclick=\'(function() { $(".emoticon-tooltip").tooltip("dispose"); })()\'>'.concat(i18n("DISPLAY_CONFIG_CLOSE"),"</button></div></div>"),$(this).tooltip({placement:"bottom",trigger:"manual",sanitize:!1,title:"&nbsp;",template:t}),void $(this).tooltip("toggle")}location.href="/api/emoticon/shop/"+e}}),"ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints||$("body").on("keydown",'[name="content"]',function(t){13!==t.keyCode||t.ctrlKey||t.altKey||t.shiftKey||($(this).closest("form").find('[type="submit"]').click(),t.preventDefault())}),$(".article-link > i").on("click",function(){var t=this,e=$(".article-link > a").text();try{navigator.clipboard.writeText(e),$(this).tooltip({delay:500,placement:"bottom",trigger:"manual",title:i18n("ARTICLE_URL_COPIED")}).on("hidden.bs.tooltip",function(){$(t).tooltip("dispose")}),$(this).tooltip("show"),setTimeout(function(){$(t).tooltip("hide")},2e3)}catch(t){prompt(i18n("ARTICLE_URL_COPY_PROMPT"),e)}}),$("#rateUpForm, #rateDownForm").on("submit",window.captchaHandlerFactory(function(t,e,a){if($(this).find("button").hasClass("already"))return animateCSS(this.querySelector("button"),"alreadyVoted"),showNotiAlert(i18n("ARTICLE_ALREADY_GIVE_BEST")),void a.stop();var n="rateDownForm"===$(this).attr("id")?-1:1,e=$.param({_csrf:r._csrf,value:n,"g-recaptcha-response":e||""});return $.ajax({type:"POST",url:"/api/rate/".concat(r.slug,"/").concat(r.articleId),dataType:"json",data:e,success:function(e){(1==n?$("#rateUpForm > button"):$("#rateDownForm > button")).addClass("already"),a.success(),Object.keys(e).forEach(function(t){$("#".concat(t)).text(e[t])})},error:function(t){a.fail(),ArcaModal.error(null===(t=t.responseJSON)||void 0===t?void 0:t.message)}}),!1},"rate","button")),$("#dealDone").on("submit",function(t){t.preventDefault();var a=$(event.target).closest("form");a.find('[type="submit"]').prop("disabled",!0),ArcaModal.create({title:i18n("ARTICLE_REQUEST_DEAL_CLOSE"),content:i18n("ARTICLE_REQUEST_DEAL_CLOSE_DESCRIPTION"),buttons:[{type:"primary",text:i18n("ARTICLE_DEAL_CLOSE"),callback:function(t,e){$.ajax({type:"post",url:a.attr("action"),data:a.serialize(),beforeSend:function(t){t.setRequestHeader("Accept","application/json")},success:function(t){location.reload()},error:function(t){t=t.responseJSON;ArcaModal.error(t.message)},failure:function(t){ArcaModal.error(t)}})}},{type:"secondary",text:i18n("DISPLAY_CONFIG_CLOSE"),callback:function(t,e){a.find('[type="submit"]').prop("disabled",!1),window.ArcaModal.close(e)}}]})}),$("#scrapForm").on("submit",function(t){$.ajax({type:"GET",url:"/api/scrap",data:{slug:r.slug,articleId:r.articleId},dataType:"json",success:function(t){t=t.isScrap?i18n("SCRAPED"):i18n("SCRAP");$("#scrapForm > button > span.result").text(t)},error:function(t){t=t.responseJSON;alert(t.message)},failure:function(t){alert(t)}}),t.preventDefault()}),!(null!==(v=location.pathname)&&void 0!==v&&v.endsWith("/write")||null!==(y=location.pathname)&&void 0!==y&&y.endsWith("/edit"))){hotkeys("c",function(t,e){"c"===e.key&&(location.href="#comment")});var a=$(".list-table").hasClass("hybrid"),e=a?$(".list-table > .vrow:not(.notice):not(.d-none)"):$(".list-table > a:not(.notice)"),p=new URL(location).pathname,m=-1,u=Array.from(e.map(function(t,e){e=a?$(e).find(".vrow-inner > .vrow-top > .vcol.col-title > a").attr("href"):e.href;return new URL(e,location.origin).pathname.startsWith(p)&&(m=t),e}));if(!(m<0)&&(hotkeys("a",function(t){var e=m+1;e<u.length&&(location.href=u[e])}),hotkeys("s",function(t){var e=m-1;0<=e&&e<u.length&&(location.href=u[e])}),!1==!!localStorage.getItem("recent_disabled"))){var f=~~(new Date/1e3),h=r.slug,v=r.articleBoardSlug,y=r.articleBoardName,g=r.articleId,e=_slicedToArray($(".board-title .head a.title"),1)[0];try{var b=(b=JSON.parse(localStorage.getItem("recent_articles")||"[]")).filter(function(t){return!(8035200<f-t.regdateAt)&&t.articleId!==g}),w=_slicedToArray($("body .article-head .title-row .title"),1)[0],C=[{boardName:y||$(e).data("channel-name"),slug:v||h,articleId:g,title:Array.from(w.childNodes).filter(function(t){return"#text"===t.nodeName||"IMG"===t.nodeName}).map(function(t){return"IMG"===t.nodeName?t.alt:t.textContent.trim()}).join(""),regdateAt:f}].concat(_toConsumableArray(b));1e3<C.length&&(C=C.slice(0,1e3)),localStorage.setItem("recent_articles",JSON.stringify(C))}catch(t){}}}}function resize(t){t.style.height=t.scrollHeight+"px"}function remoteExists(n){return new Promise(function(e,t){var a=new Image;a.onload=function(){e(0!==a.height)},a.onerror=function(t){e(!1)},a.src=n})}function opengraphHandler(){function e(t){var e=document.createElement("iframe");return e.src=t,e.width=640,e.height=480,e.allowfullscreen=!0,e.loading="lazy",e.referrerPolicy="origin",e.allow="autoplay",e.outerHTML}var o={"https://*.youtube.com/watch*":"https://www.youtube.com/oembed","https://*.youtube.com/v/*":"https://www.youtube.com/oembed","https://*.youtube.com/shorts/*":"https://www.youtube.com/oembed","https://youtube.com/shorts/*":"https://www.youtube.com/oembed","https://youtu.be/*":"https://www.youtube.com/oembed","https://*.youtube.com/playlist?list=*":"https://www.youtube.com/oembed","https://youtube.com/playlist?list=*":"https://www.youtube.com/oembed","https://play.afreecatv.com/*/*":"https://openapi.afreecatv.com/oembed/embedinfo","https://vod.afreecatv.com/ST/*":"https://openapi.afreecatv.com/oembed/embedinfo","https://vod.afreecatv.com/player/*":"https://openapi.afreecatv.com/oembed/embedinfo","https://v.afree.ca/ST/*":"https://openapi.afreecatv.com/oembed/embedinfo","http://soundcloud.com/*":"https://soundcloud.com/oembed","https://soundcloud.com/*":"https://soundcloud.com/oembed","https://soundcloud.app.goog.gl/*":"https://soundcloud.com/oembed","http://streamable.com/*":"https://api.streamable.com/oembed.json","https://streamable.com/*":"https://api.streamable.com/oembed.json","https://vimeo.com/*":"https://vimeo.com/api/oembed.json","https://vimeo.com/album/*/video/*":"https://vimeo.com/api/oembed.json","https://vimeo.com/channels/*/*":"https://vimeo.com/api/oembed.json","https://vimeo.com/groups/*/videos/*":"https://vimeo.com/api/oembed.json","https://vimeo.com/ondemand/*/*":"https://vimeo.com/api/oembed.json","https://player.vimeo.com/video/*":"https://vimeo.com/api/oembed.json"},r={"https://www.youtube.com/oembed":{data:{}},"https://openapi.afreecatv.com/oembed/embedinfo":{data:{}},"https://soundcloud.com/oembed":{data:{format:"json"}},"https://api.streamable.com/oembed.json":{data:{}},"https://vimeo.com/api/oembed.json":{data:{}}},i={"https://www.youtube.com/oembed":function(t){t=new URL($(t).attr("src"));return t.searchParams.set("autoplay",1),e(t.href)},"https://openapi.afreecatv.com/oembed/embedinfo":function(t){t=new URL($(t).attr("src"));return t.searchParams.set("autoPlay",!0),e(t.href)},"https://soundcloud.com/oembed":function(t){t=new URL($(t).attr("src"));return t.searchParams.set("auto_play",!0),e(t.href)},"https://api.streamable.com/oembed.json":function(t){t=new URL($(t).attr("src"));return t.searchParams.set("autoplay",1),e(t.href)},"https://vimeo.com/api/oembed.json":function(t){t=new URL($(t).attr("src"));return t.searchParams.set("autoplay",1),e(t.href)}};Object.keys(o).forEach(function(t){o[t]={regex:new RegExp(t.replace(/\*/g,"(.*)").replace(/\?/g,"\\?"),"i"),endpoint:o[t]}}),$(".link-card").off("click.linkcard").on("click.linkcard",function(t){var n;t.ctrlKey||t.shiftKey||t.altKey||t.metaKey||(t.preventDefault(),t.stopPropagation(),n=$(this),t=this.parentElement,!n.hasClass("oembed-opened")&&Object.keys(o).some(function(e){try{var t=new URL(this.href),a="https://oo.pe"===t.origin?t.href.replace(t.origin,"").replace(/^\//,""):parsedURL.href}catch(t){}if(a&&a.match(o[e].regex)){t=Object.assign({type:"GET",url:o[e].endpoint,dataType:"json",data:{},success:function(t){0===n.find(".oembed-area").length&&(n.prepend($('<div class="w-100 oembed-area"></div>').append(i[o[e].endpoint](t.html))),n.addClass("oembed-opened"),n.find(".link-card-thumbnail-wrapper").remove(),n.find(".link-card-content").css("width","100%"))}.bind(this),error:function(){this.click()}.bind(this)},r[o[e].endpoint]);return t.data.url=a,$.ajax(t),!0}return!1},t)||t.click())})}$("[data-toggle='tooltip']").tooltip(),$(".body .article-body img, .body .article-body video").not("img.twemoji").each(function(){var t=$(this),e=t.parent();if("IMG"===t.prop("tagName")&&"defaultImage"!==e.attr("id"))if("A"!==e.prop("tagName"))if(t.data("store-id"))t.wrap($("<a>",{href:"/e/".concat(t.data("store-id"))}));else try{var a=new URL(t.attr("src").startsWith("//")?"https:".concat(t.attr("src")):t.attr("src"));a.searchParams.set("type","orig"),a.searchParams.sort(),t.wrap($("<a>",{href:a.href,target:"_blank"}))}catch(t){}else try{var n=new URL(e.attr("href").startsWith("//")?"https:".concat(e.attr("href")):e.attr("href")),o=new URL(t.prop("src"));o.origin===n.origin&&o.pathname===n.pathname&&n.searchParams.has("key")&&n.searchParams.has("expires")&&(s(n,o,["key","expires"]),n.searchParams.set("type","orig"),e.attr("href",n.href))}catch(t){}if("VIDEO"===t.prop("tagName"))if("A"!==e.prop("tagName")){if(t.data("store-id")&&t.hasClass("arca-emoticon"))t.wrap($("<a>",{href:"/e/".concat(t.data("store-id")),target:"_blank"}));else if("gif"===t.data("orig"))try{var r=new URL(t.data("originalurl").startsWith("//")?"https:".concat(t.data("originalurl")):t.data("originalurl"));r.searchParams.set("type","orig"),t.wrap($("<a>",{href:r.href,target:"_blank"}))}catch(t){}}else try{var i=new URL(e.attr("href").startsWith("//")?"https:".concat(e.attr("href")):e.attr("href")),c=new URL(t.prop("src"));c.origin===i.origin&&c.pathname===i.pathname&&i.searchParams.has("key")&&i.searchParams.has("expires")&&(s(i,c,["key","expires"]),i.searchParams.set("type","orig"),i.searchParams.sort(),e.attr("href",i.href))}catch(t){}function s(a,n,t){t=2<arguments.length&&void 0!==t?t:[];if(t.length)t.forEach(function(t){var e=n.searchParams.get(t);e&&a.searchParams.set(t,e)});else{var e,o=_createForOfIteratorHelper(n.searchParams.entries());try{for(o.s();!(e=o.n()).done;){var r=_slicedToArray(e.value,2),i=r[0],c=r[1];a.searchParams.set(i,c)}}catch(t){o.e(t)}finally{o.f()}}}}),$(".btn-block-user").bind("click",function(){var t,e=$(this).closest("form"),a=$("option:selected",e.find("select[name='until']"));-1==a.val()&&(t=parseInt(86400*parseFloat(prompt(i18n("BOARD_BATCH_BLOCK_DATE_PROMPT")))));var n=e.find("input[name='description']"),e=prompt(i18n("BOARD_BATCH_BLOCK_REASON_PROMPT"));return!!confirm(i18n("BOARD_BATCH_BLOCK_CONFIRM"))&&(t&&a.val(t),e&&n.val(e),!0)}),$(".article-wrapper").on("mouseenter focus",".emoticon-wrapper > video",function(t){var e=$(this);!e.attr("autoplay")&&e.data("src")&&e.attr("src",$(this).data("src"));try{this.play()}catch(t){}}),$(".article-wrapper").on("mouseleave",".emoticon-wrapper > video",function(t){var e=$(this);if(!e.attr("autoplay")&&e.data("src"))try{this.pause()}catch(t){}}),function(){function a(t,e,a){return.2126*(a=[t,e,a].map(function(t){return(t/=255)<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}))[0]+.7152*a[1]+.0722*a[2]}function o(t,e){return t=a(t[0],t[1],t[2]),e=a(e[0],e[1],e[2]),(Math.max(t,e)+.05)/(Math.min(t,e)+.05)}var r=parseCSSColor(getComputedStyle(document.documentElement).getPropertyValue("--color-bg-main"));parseCSSColor(getComputedStyle(document.documentElement).getPropertyValue("--color-text-color"));$("html").is(".theme-dark")&&$(".article-content *").each(function(){var t=$(this),e=getComputedStyle(this),a=parseCSSColor(e.color),n=parseCSSColor(e.backgroundColor),e=!1;"0000"===n.join("")?e=!0:6<o(n,r)&&(t.css("background-color","initial"),e=!0),e&&o(a,r)<3&&t.css("color","")})}(),function(){var a,n,o,t,e,r=$(".article-content video").filter(function(){return!$(this).hasClass("arca-emoticon")&&"gif"!==$(this).attr("data-orig")});0!==r.length&&(a=new Set,"IntersectionObserver"in window&&(o=new IntersectionObserver(function(t,e){t.forEach(function(t){.3<t.intersectionRatio?a.add(t.target):(a.delete(t.target),t.target.paused||$(t.target).trigger("pause"))}),0===a.size&&(n=void 0)},{threshold:[.2,.5,1]}),r.each(function(t,e){o.observe(e)})),$(window).on("scroll.video-autoplay",function(){var t,e;0===a.size||(e=(t=function(t){var e,a,n=window.innerHeight/2,o=1/0,r=_createForOfIteratorHelper(t);try{for(r.s();!(a=r.n()).done;){var i=a.value,c=i.getBoundingClientRect(),s=Math.abs(c.top+c.height/2-n);s<o&&(o=s,e=i)}}catch(t){r.e(t)}finally{r.f()}return{video:e,distance:o}}(a)).video,t.distance,n!==e&&(n=e,r.removeClass("video-autoplay").trigger("pause"),$(e).addClass("video-autoplay").trigger("play")))}),0<(e=(t=document.querySelector(".article-content video[controls]")).getBoundingClientRect()).top&&e.bottom<window.innerHeight&&(t.autoplay=!0,t.load()))}(),function(){var a,n,m,u;"undefined"==typeof Promise||0!==(a=$(".article-content img").filter(function(t,e){return 100<(e.naturalWidth||~~e.getAttribute("width"))&&100<(e.naturalHeight||~~e.getAttribute("height"))&&-1===e.className.indexOf("twemoji")})).length&&(n=$("<a>").addClass("btn btn-arca btn-sm float-left").attr("id","imageToZipBtn").append($("<span>").addClass("ion-android-download"),$("<span>").addClass("d-sm-inline d-md-none").text(" ".concat(i18n("ARTICLE_IMAGE_SAVE"))),$("<span>").addClass("d-none d-md-inline").text(" ".concat(i18n("ARTICLE_ALL_IMAGE_DOWNLOAD")))),$(".article-wrapper .article-menu").prepend(n),m=$("<div>").addClass("download-progress"),u=document.querySelector('meta[name="title"]').content,n.on("click",function(){var t,e;n.hasClass("loading")||confirm(i18n("ARTICLE_ALL_IMAGE_DOWNLOAD_CONFIRM"))&&(t=[],"function"!=typeof JSZip&&t.push($.ajax({dataType:"script",cache:!0,url:"/node_modules/jszip/dist/jszip.min.js"+(null===(e=LiveConfig)||void 0===e?void 0:e.CACHE_KEY)})),"function"!=typeof saveAs&&t.push($.ajax({dataType:"script",cache:!0,url:"/node_modules/file-saver/dist/FileSaver.min.js"+(null===(e=LiveConfig)||void 0===e?void 0:e.CACHE_KEY)})),Promise.all(t).then(function(){n.addClass("loading disabled"),n.append($("<div>").addClass("spinner-border spinner-border-sm")).prepend(m);var c=new JSZip,s=0;function l(r,i){return new Promise(function(e,t){var a=u+" "+i.toString().padStart(3,"0")+"."+new URL(r).pathname.split(".").pop(),n=new URL(r),o=n.searchParams;o.set("nc",Date.now()),o.set("type","orig");o="".concat(n.protocol,"//").concat(n.host).concat(n.pathname,"?").concat(o.toString());fetch(o).then(function(t){c.file(a,t.blob()),s+=1,m.css("width",(s/p.length*100).toFixed()/2+"%"),e()},function(){s+=1,m.css("width",(s/p.length*100).toFixed()/2+"%"),t()})})}var d=new Set;var p=Array.from(a).map(function(o,r){var i=new URL(o.src);return i.host.split(".")[0].endsWith("-p")||i.host.split(".")[0].endsWith("-o")?l(i.toString(),r):new Promise(function(t,e){var n,a=new URL(o.src);a.host=a.host.replace(/^([^.]+)(.+)/,"$1-o$2"),d.has(a.host)?l(i.toString(),r).then(function(){t()}).catch(function(){e()}):(n=a.toString(),new Promise(function(t,e){var a=new Image;a.src=n,a.onload=function(){t(n)},a.onerror=function(){e()}}).then(function(){l(a.toString(),r).then(function(){t()}).catch(function(){e()})}).catch(function(){d.add(a.host),l(i.toString(),r).then(function(){t()}).catch(function(){e()})}))})});Promise.all(p).then(function(){0<Object.keys(c.files).length?c.generateAsync({type:"blob",compression:"STORE"},function(t){m.css("width",50+t.percent.toFixed()/2+"%")}).then(function(t){saveAs(t,(location.pathname.match(/\/b\/[0-9a-zA-Z]+\/([0-9]+)/)?location.pathname.match(/\/b\/[0-9a-zA-Z]+\/([0-9]+)/)[1]:"arca")+".zip"),m.text("").css("width","0").remove(),n.removeClass("loading disabled"),$("#imageToZipBtn .spinner-border").remove()}):(n.removeClass("loading").text("".concat(i18n("ARTICLE_DOWNLOAD_FAIL"),"..")),$("#imageToZipBtn .spinner-border").remove())}).catch(function(){m.text("").remove(),n.text("".concat(i18n("ARTICLE_DOWNLOAD_FAIL"),"..")),$("#imageToZipBtn .spinner-border").remove()})}).catch(function(){alert("Fail to load script.")}))}))}(),function(){var a=$('.article-content iframe.arca-vote[src*="/api/vote_"]').outerHeight()||150;function e(o){$(".tweet").each(function(t,e){var a=new URL(e.getAttribute("src")),n=new URLSearchParams(a.searchParams);n.set("theme",o);n="".concat(a.origin).concat(a.pathname,"?").concat(n.toString());e.setAttribute("src",n)})}window.resizeVoteIframe=function(t){var e=$('.article-content iframe[src="/api/vote_detail/'.concat(t,'"]'));e.length&&(t=e.contents().find("body").outerHeight(),a<=t&&e.animate({height:t},100))},$("html").on("classChange",function(t){var a=$("html").is(".theme-dark")?"dark":"light";$(".article-content iframe").each(function(t,e){e.contentWindow.postMessage({mode:a},window.origin)}),e(a)}),e($("html").is(".theme-dark")?"dark":"light")}();var _trustedDomains=["namu.wiki","namu.news"];function oopeHandler(){function f(){if(!window.localStorage)return _trustedDomains;var t=window.localStorage.getItem("trust-domain"),e=[];if(t)try{e=JSON.parse(t)}catch(t){e=[]}return e.push.apply(e,_trustedDomains),e}function h(t,e){(t=t.cloneNode()).href=e,t.click()}$("a.external").off("click.oope").on("click.oope",function(t){t.preventDefault(),t.stopPropagation();var n,o=this;try{var e=new URL($(o).attr("href")),a="https://oo.pe"===e.origin?e.href.replace(e.origin,"").replace(/^\//,""):l.href}catch(t){}if(a){if($(o).hasClass("allowed"))return $(o).removeClass("allowed"),void h(o,a);if(window.LiveConfig.oope.rl[a])h(o,window.LiveConfig.oope.rl[a]);else{e=[];window.LiveConfig.oope.ol[a]&&e.push(window.LiveConfig.oope.ol[a]),e.push(a);for(var r,i=0,c=e;i<c.length;i++){var s=c[i];try{var l=new URL(s,location.origin);if(s===a&&(n=l.hostname),window.LiveConfig.oope.lp[l.hostname])return void h(o,s);if(l.hostname.replace(/^(?:www|m)\./,"")===atob("cW9vMTAuY29t")){var d=l.pathname.split("/"),p=d[1];if(1<d.length&&["g","item","gmkt.inc"].includes(p)){var m=void 0;if("gmkt.inc"===p?m=l.searchParams.get("goodscode"):(m=d[d.length-1]).includes("Q")&&(m=d[d.length-2]),!isNaN(parseInt(m))){var u=new URL(atob("aHR0cHM6Ly93d3cucW9vMTAuY29tLw=="));return u.pathname="/g/".concat(m,"/Q189714901"),void h(o,u.toString())}}}}catch(t){}}!n||(r=n,window.LiveConfig.oope.black.includes(r)||!window.LiveConfig.oope.white.includes(r)&&!f().includes(r))?((e=$("<div>")).append($("<div>").text(i18n("OOPE_DESCRIPTION"))),e.append($("<div>").addClass("text-center").css("margin","1rem").append($("<b>").text(a))),e.append($("<div>").text(i18n("OOPE_CONFIRM"))),r=[{type:"danger",text:i18n("MOVE"),callback:function(t,e){window.ArcaModal.close(e),$(o).addClass("allowed"),o.click()}},{text:i18n("CANCEL"),callback:function(t,e){window.ArcaModal.close(e)}},{type:"link",text:i18n("OOPE_TRUST_DOMAIN"),callback:function(t,e){var a;window.ArcaModal.close(e),$(o).addClass("allowed"),o.click(),n&&(a=n,window.localStorage&&(-1<(e=f()).indexOf(a)||(e.push(a),e=JSON.stringify(e),window.localStorage.setItem("trust-domain",e))))}}],window.ArcaModal.create({title:i18n("OOPE_TITLE"),content:e,buttons:window.LiveConfig.oope.black.includes(n)?r.slice(0,2):r})):h(o,a)}}})}$(function(){opengraphHandler(),oopeHandler()}),function(){var t=location.pathname.match(/^\/b\/.+\/\d+\/(\d+)/);t&&!location.hash&&(location.href="#c_"+t[1])}(),applyCommentMoreButton();